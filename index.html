<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Rabbito Editor</title>

  <link href="./dist/styles.css" rel="stylesheet">
  <link rel="stylesheet" href="./node_modules/katex/dist/katex.min.css">
  <link rel="stylesheet" data-name="vs/editor/editor.main"
    href="./node_modules/monaco-editor/min/vs/editor/editor.main.css">
</head>

<body class="overflow-hidden">

  <div id="app"></div>

  <script type="text/javascript">
    window.languagePluginUrl = 'https://cdn.jsdelivr.net/pyodide/v0.16.1/full/';
  </script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.16.1/full/pyodide.js"></script>

  <script>
    let parserLoaded = false;
    // init Pyodide
    languagePluginLoader.then(async () => {
      await pyodide.runPythonAsync(`
      import micropip
      micropip.install('markdown')
      micropip.install('pymdown-extensions')
      micropip.install('pygments')
    `);
      await pyodide.runPythonAsync(`
      from markdown import Markdown

      MD_EXTENSIONS = [
        'footnotes',
        'def_list',
        'toc',
        'pymdownx.arithmatex',
        'pymdownx.betterem',
        'pymdownx.caret',
        'pymdownx.critic',
        'pymdownx.details',
        'pymdownx.inlinehilite',
        'pymdownx.magiclink',
        'pymdownx.mark',
        'pymdownx.smartsymbols',
        'pymdownx.superfences',
        'pymdownx.tasklist',
        'pymdownx.tilde',
        'pymdownx.pathconverter',
        'admonition',
        'meta',
        'codehilite',
        'tables',
      ]
      MD_EXTENSIONS_CONFIG = {
        'pymdownx.pathconverter': {
          'base_path': '/GCS/POST_STORAGE_BUCKET/BLOG_NAME/POST_SLUG/',
          'absolute': True,
          'tags': 'img',
        },
        'toc': {
          'marker': '',
          'permalink': True,
        },
        'pymdownx.arithmatex': {
          'generic': True,
        },
        'pymdownx.betterem': {
          'smart_enable': 'all',
        },
        'pymdownx.tasklist': {
          'custom_checkbox': 'true',
        }
      }
    `);

      parserLoaded = true;
    });

    function parseMd(md) {
      return pyodide.runPython(`
md = Markdown(extensions=MD_EXTENSIONS, extension_configs=MD_EXTENSIONS_CONFIG)
md.convert("""${md.replace(/\\/g, '\\\\')}""")
    `);
    }
  </script>

  <!-- <script>var require = { paths: { 'vs': './node_modules/monaco-editor/min/vs' } };</script>
  <script src="./node_modules/monaco-editor/min/vs/loader.js"></script>
  <script src="./node_modules/monaco-editor/min/vs/editor/editor.main.nls.js"></script>
  <script src="./node_modules/monaco-editor/min/vs/editor/editor.main.js"></script>
  <script src="./node_modules/monaco-markdown/umd/monaco-markdown.js"></script> -->
  <!-- <script>
    let model;

    setTimeout(() => {
      require(['MonacoMarkdown'], function (MonacoMarkdown) {
        let extension = new MonacoMarkdown.MonacoMarkdownExtension();
        extension.activate(editor);
      });

      model.onDidChangeContent(() => {
        // console.log(m)
        previewEl.innerHTML = renderMath(parseMd(model.getValue()));
      })

      setTimeout(() => {
        previewEl.innerHTML = parseMd(model.getValue());
      }, 10000);

    }, 100);
  </script> -->
  <script src="./dist/renderer.js" type="module"></script>

</body>

</html>